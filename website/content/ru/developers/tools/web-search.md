# Инструмент веб-поиска (`web_search`)

Этот документ описывает инструмент `web_search` для выполнения веб-поиска с использованием нескольких провайдеров.

## Описание

Используйте `web_search` для выполнения веб-поиска и получения информации из интернета. Инструмент поддерживает несколько поставщиков поиска и возвращает краткий ответ с указанием источников, если они доступны.

### Поддерживаемые провайдеры

1. **DashScope** (официальный, бесплатный) - Автоматически доступен для пользователей Qwen OAuth (200 запросов в минуту, 1000 запросов в день)
2. **Tavily** - Поисковое API высокого качества с встроенной генерацией ответов
3. **Google Custom Search** - JSON API пользовательского поиска Google

### Аргументы

`web_search` принимает два аргумента:

- `query` (строка, обязательный): Поисковый запрос
- `provider` (строка, необязательный): Конкретный провайдер для использования ("dashscope", "tavily", "google")
  - Если не указан, используется провайдер по умолчанию из конфигурации

## Конфигурация

### Метод 1: Файл настроек (рекомендуется)

Добавьте в ваш `settings.json`:

```json
{
  "webSearch": {
    "provider": [
      { "type": "dashscope" },
      { "type": "tavily", "apiKey": "tvly-xxxxx" },
      {
        "type": "google",
        "apiKey": "your-google-api-key",
        "searchEngineId": "your-search-engine-id"
      }
    ],
    "default": "dashscope"
  }
}
```

**Примечания:**

- DashScope не требует API-ключа (официальный, бесплатный сервис)
- **Пользователи Qwen OAuth:** DashScope автоматически добавляется в ваш список провайдеров, даже если он не настроен явно
- Настройте дополнительные провайдеры (Tavily, Google), если вы хотите использовать их вместе с DashScope
- Установите `default`, чтобы указать, какой провайдер использовать по умолчанию (если не установлен, порядок приоритета: Tavily > Google > DashScope)

### Метод 2: Переменные окружения

Установите переменные окружения в вашей оболочке или файле `.env`:

```bash

# Tavily
export TAVILY_API_KEY="tvly-xxxxx"
```

# Google
export GOOGLE_API_KEY="ваш-ключ-api"
export GOOGLE_SEARCH_ENGINE_ID="ваш-идентификатор-поисковой-системы"
```

### Метод 3: Аргументы командной строки

Передайте ключи API при запуске Qwen Code:

```bash

# Tavily
qwen --tavily-api-key tvly-xxxxx

# Google
qwen --google-api-key ваш-ключ --google-search-engine-id ваш-идентификатор

# Укажите поставщика по умолчанию
qwen --web-search-default tavily
```

### Обратная совместимость (устаревшее)

⚠️ **УСТАРЕЛО:** Устаревшая конфигурация `tavilyApiKey` все еще поддерживается для обратной совместимости, но считается устаревшей:

```json
{
  "advanced": {
    "tavilyApiKey": "tvly-xxxxx" // ⚠️ Устарело
  }
}
```

**Важно:** Эта конфигурация устарела и будет удалена в будущей версии. Пожалуйста, перейдите на новый формат конфигурации `webSearch`, показанный выше. Старая конфигурация автоматически настроит Tavily как поставщика, но мы настоятельно рекомендуем обновить вашу конфигурацию.

## Отключение веб-поиска

Если вы хотите отключить функцию веб-поиска, вы можете исключить инструмент `web_search` в вашем файле `settings.json`:

```json
{
  "tools": {
    "exclude": ["web_search"]
  }
}
```

**Примечание:** Для применения этого параметра требуется перезапуск Qwen Code. После отключения инструмент `web_search` не будет доступен модели, даже если поставщики веб-поиска настроены.

## Примеры использования

### Базовый поиск (с использованием поставщика по умолчанию)

```
web_search(query="последние достижения в ИИ")
```

### Поиск с указанием конкретного поставщика

```
web_search(query="последние достижения в ИИ", provider="tavily")
```

### Примеры из реальной жизни

```
web_search(query="погода в Сан-Франциско сегодня")
web_search(query="последняя LTS-версия Node.js", provider="google")
web_search(query="лучшие практики для React 19", provider="dashscope")
```

## Подробная информация о поставщиках

### DashScope (официальный)

- **Стоимость:** Бесплатно
- **Аутентификация:** Автоматически доступен при использовании аутентификации Qwen OAuth
- **Конфигурация:** Не требуется API-ключ, автоматически добавляется в список провайдеров для пользователей Qwen OAuth
- **Квота:** 200 запросов/минуту, 1000 запросов/день
- **Лучше всего подходит для:** Общих запросов, всегда доступен как резервный вариант для пользователей Qwen OAuth
- **Автоматическая регистрация:** Если вы используете Qwen OAuth, DashScope автоматически добавляется в ваш список провайдеров, даже если вы не настраиваете его явно

### Tavily

- **Стоимость:** Требуется API-ключ (платный сервис с бесплатным тарифом)
- **Регистрация:** https://tavily.com
- **Возможности:** Высококачественные результаты с ответами, созданными ИИ
- **Лучше всего подходит для:** Исследований, исчерпывающих ответов с ссылками на источники

### Google Custom Search

- **Стоимость:** Доступен бесплатный тариф (100 запросов/день)
- **Настройка:**
  1. Включите Custom Search API в Google Cloud Console
  2. Создайте Custom Search Engine на https://programmablesearchengine.google.com
- **Возможности:** Качество поиска Google
- **Лучше всего подходит для:** Конкретных, фактических запросов

## Важные замечания

- **Формат ответа:** Возвращает краткий ответ с нумерованными ссылками на источники
- **Цитирования:** Ссылки на источники добавляются в виде нумерованного списка: [1], [2] и т.д.
- **Несколько провайдеров:** Если один из провайдеров не работает, вручную укажите другой с помощью параметра `provider`
- **Доступность DashScope:** Автоматически доступен для пользователей Qwen OAuth, дополнительная настройка не требуется
- **Выбор провайдера по умолчанию:** Система автоматически выбирает провайдера по умолчанию в зависимости от доступности:
  1. Ваша явная конфигурация `default` (наивысший приоритет)
  2. Аргумент командной строки `--web-search-default`
  3. Первый доступный провайдер по приоритету: Tavily > Google > DashScope

## Устранение неполадок

**Инструмент недоступен?**

- **Для пользователей Qwen OAuth:** Инструмент автоматически регистрируется с поставщиком DashScope, дополнительная настройка не требуется
- **Для других типов аутентификации:** Убедитесь, что хотя бы один поставщик (Tavily или Google) настроен
- Для Tavily/Google: Проверьте правильность ваших API-ключей

**Ошибки конкретного провайдера?**

- Используйте параметр `provider`, чтобы попробовать другой поисковый провайдер
- Проверьте квоты и ограничения по скорости вашего API
- Убедитесь, что API-ключи правильно установлены в конфигурации

**Нужна помощь?**

- Проверьте свою конфигурацию: запустите `qwen` и используйте диалог настроек
- Посмотрите текущие настройки в `~/.qwen-code/settings.json` (macOS/Linux) или `%USERPROFILE%\.qwen-code\settings.json` (Windows)