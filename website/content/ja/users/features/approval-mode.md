# 承認モード

Qwen Code は、タスクの複雑さやリスクレベルに応じて、AI がコードやシステムとどのようにやり取りするかを柔軟に制御できる3つの異なるパーミッションモードを提供しています。

## パーミッションモードの比較

| モード           | ファイル編集                  | シェルコマンド              | 最適な用途                                                                                             | リスクレベル |
| -------------- | --------------------------- | --------------------------- | ------------------------------------------------------------------------------------------------------ | ---------- |
| **Plan**​      | ❌ 読み取り専用での分析のみ   | ❌ 実行されません           | • コードの探索 <br>• 複雑な変更の計画 <br>• 安全なコードレビュー                                       | 最低       |
| **Default**​   | ✅ 承認が必要               | ✅ 承認が必要               | • 新しい/不慣れなコードベース <br>• 重要なシステム <br>• チームでの共同作業 <br>• 学習と教育         | 低         |
| **Auto-Edit**​ | ✅ 自動承認                 | ❌ 承認が必要               | • 日常的な開発タスク <br>• リファクタリングとコード改善 <br>• 安全な自動化                            | 中         |
| **YOLO**​      | ✅ 自動承認                 | ✅ 自動承認                 | • 信頼できる個人プロジェクト <br>• 自動スクリプト/CI/CD <br>• バッチ処理タスク                       | 最高       |

### クイックリファレンスガイド

- **プランモードで開始**: 変更を行う前に理解するのに最適
- **デフォルトモードで作業**: ほとんどの開発作業にバランスの取れた選択
- **オートエディットに切り替える**: 多くの安全なコード変更を行う場合
- **YOLOは控えめに使用**: 制御された環境での信頼できる自動化の場合のみ

> [!tip]
>
> セッション中に **Shift+Tab** (Windowsでは **Tab**) を使用してモードを素早く切り替えることができます。ターミナルのステータスバーには現在のモードが表示されるため、常にQwen Codeが持っている権限がわかります。

## 1. 安全なコード分析にはプランモードを使用

プランモードでは、Qwen Codeに対してコードベースを**読み取り専用**操作で分析し、プランを作成するよう指示します。これはコードベースの探索、複雑な変更の計画立案、または安全なコードレビューに最適です。

### プランモードを使用するタイミング

- **複数ステップの実装**: 機能追加にあたり、多数のファイルを編集する必要がある場合
- **コードの探索**: 何かを変更する前に、コードベースを彻底的に調査したい場合
- **対話的な開発**: Qwen Code と方向性を反復的に調整しながら開発を進めたい場合

### プランモードの使用方法

**セッション中にプランモードを有効にする**

**Shift+Tab** (または Windows では **Tab**) を使用してパーミッションモードを切り替えることで、セッション中にプランモードに切り替えることができます。

通常モードの場合、**Shift+Tab** (または Windows では **Tab**) でまず `auto-edits` モードに切り替わり、端末の下部に `⏵⏵ accept edits on` と表示されます。さらに **Shift+Tab** (または Windows では **Tab**) を押すと、プランモードに切り替わり、`⏸ plan mode` と表示されます。

**プランモードで新しいセッションを開始する**

プランモードで新しいセッションを開始するには、`/approval-mode` を使用して `plan` を選択します。

```bash
/approval-mode
```

**プランモードで「ヘッドレス」クエリを実行する**

また、`-p` または `prompt` を使用して、プランモードで直接クエリを実行することもできます。

```bash
qwen --prompt "機械学習とは何ですか？"
```

### 例：複雑なリファクタリングの計画

```bash
/approval-mode plan
```

```
認証システムをOAuth2を使用するようにリファクタリングする必要があります。詳細な移行計画を作成してください。
```

Qwen Codeは現在の実装を分析し、包括的な計画を作成します。以下のフォローアップで洗練させます。

```
下位互換性についてはどうなりますか？
データベースの移行はどのように処理すべきですか？
```

### プランモードをデフォルトとして設定

```json
// .qwen/settings.json
{
  "permissions": {
    "defaultMode": "plan"
  }
}
```

## 2. デフォルトモードを使用して制御された操作を行う

デフォルトモードは、Qwen Codeと作業する標準的な方法です。このモードでは、ファイル変更やシェルコマンドの実行など、潜在的にリスクのあるすべての操作を完全に制御できます。Qwen Codeは、ファイル変更やシェルコマンドを実行する前にあなたの承認を求めます。

### デフォルトモードを使用するタイミング

- **コードベースに不慣れな場合**: 未知のプロジェクトを探索していて、特に注意が必要なとき
- **重要なシステムの場合**: 本番コード、インフラストラクチャ、または機密データを扱うとき
- **学習や教育の場面**: Qwen Code が行っている各ステップを理解したいとき
- **チームでの共同作業**: 複数の人が同じコードベースで作業しているとき
- **複雑な操作**: 変更が複数のファイルや複雑なロジックを含む場合

### デフォルトモードの使用方法

**セッション中にデフォルトモードを有効にする**

セッション中に **Shift+Tab**​ (Windows の場合は **Tab**) を押してパーミッションモードを切り替えることで、デフォルトモードに切り替えることができます。他のモードにいる場合、**Shift+Tab** (Windows の場合は **Tab**) を押すと最終的にデフォルトモードに戻り、ターミナルの下部にモードインジケーターが表示されなくなることで確認できます。

**新しいセッションをデフォルトモードで開始する**

デフォルトモードは Qwen Code を起動した際の初期モードです。モードを変更してデフォルトモードに戻りたい場合は、以下を使用してください：

```
/approval-mode default
```

**デフォルトモードで「ヘッドレス」クエリを実行する**

ヘッドレスコマンドを実行する際は、デフォルトモードがデフォルトの動作となります。以下のように明示的に指定することも可能です：

```
qwen --prompt "このコードの潜在的なバグを分析してください"
```

### 例：安全に機能を実装する

```
/approval-mode default
```

```
アプリケーションにユーザープロフィール画像を追加する必要があります。画像はS3バケットに保存し、URLはデータベースに保存してください。
```

Qwen Code はコードベースを分析して計画を提案します。その後、以下の操作を行う前に承認を求めます。

1. 新しいファイルの作成（コントローラー、モデル、マイグレーション）
2. 既存ファイルの変更（新しいカラムの追加、APIの更新）
3. シェルコマンドの実行（データベースマイグレーション、依存関係のインストール）

各提案された変更を確認し、個別に承認または拒否できます。

### デフォルトモードをデフォルトとして設定

```bash
// .qwen/settings.json
{
  "permissions": {
    "defaultMode": "default"
  }
}
```

## 3. 自動編集モード

自動編集モードでは、Qwen Code がファイル編集を自動的に承認し、シェルコマンドについては手動での承認が必要になります。これは開発ワークフローを加速しつつシステムの安全性を維持するのに理想的です。

### 自動承認編集モードを使用するタイミング

- **日常開発時**: ほとんどのコーディングタスクに最適
- **安全な自動化**: 危険なコマンドの誤実行を防ぎながらAIによるコード変更を許可
- **チームでの共同作業**: 共有プロジェクトで他の人に意図しない影響を与えることを回避するために使用

### このモードへの切り替え方法

```

# コマンドで切り替え
/approval-mode auto-edit

# またはキーボードショートカットを使用
Shift+Tab (WindowsではTab) # 他のモードから切り替える場合
```

### ワークフロー例

1. Qwen Codeに関数のリファクタリングを依頼
2. AIがコードを分析し、変更を提案
3. **自動的に**​すべてのファイル変更を確認なしで適用
4. テストを実行する必要がある場合は、`npm test` の実行について**承認を要求**​

## 4. YOLOモード - 完全自動化

YOLOモードでは、Qwen Codeに最高権限を与え、ファイル編集やシェルコマンドを含むすべてのツール呼び出しを自動承認します。

### YOLO モードを使用するタイミング

- **自動化スクリプト**: 事前定義された自動タスクを実行する場合
- **CI/CD パイプライン**: 制御された環境での自動実行
- **個人プロジェクト**: 完全に信頼できる環境での迅速なイテレーション
- **バッチ処理**: 複数ステップのコマンドチェーンを必要とするタスク

> [!warning]
>
> **YOLO モードは注意して使用してください**: AI はあなたの端末権限で任意のコマンドを実行できます。以下の点を確認してください:
>
> 1. 現在のコードベースを信頼できること
> 2. AI が実行するすべてのアクションを理解していること
> 3. 重要なファイルがバックアップされているか、バージョン管理にコミットされていること

### YOLO モードの有効化方法

```

# 一時的に有効化（現在のセッションのみ）
/approval-mode yolo

# プロジェクトのデフォルトとして設定
/approval-mode yolo --project

# ユーザー全体のデフォルトとして設定
/approval-mode yolo --user
```

### 設定例

```bash
// .qwen/settings.json
{
  "permissions": {
    "defaultMode": "yolo",
    "confirmShellCommands": false,
    "confirmFileEdits": false
  }
}
```

### 自動化ワークフローの例

```bash

```

# 完全自動リファクタリングタスク
qwen --prompt "テストスイートを実行し、失敗したすべてのテストを修正してから変更をコミットする"

# 人間の介入なしに、AIは以下の処理を行います：

# 1. テストコマンドを実行（自動承認）

# 2. 失敗したテストケースを修正（ファイルを自動編集）

# 3. git commit を実行（自動承認）
```

## モード切替と設定

### キーボードショートカットによる切替

Qwen Codeセッション中に、**Shift+Tab**​（またはWindowsでは**Tab**）を使用して、3つのモードを素早く切り替えられます：

```
デフォルトモード → 自動編集モード → YOLOモード → プランモード → デフォルトモード
```

### 永続的な設定

```
// プロジェクトレベル: ./.qwen/settings.json
// ユーザーレベル: ~/.qwen/settings.json
{
  "permissions": {
    "defaultMode": "auto-edit",  // または "plan" または "yolo"
    "confirmShellCommands": true,
    "confirmFileEdits": true
  }
}
```

### モード使用の推奨事項

1. **コードベースに不慣れな場合**: 安全な探索のために**プランモード**から始めてください
2. **日常的な開発作業**: （デフォルトモードである）**オートアクセプトエディット**を使用し、効率的かつ安全に作業してください
3. **自動化スクリプト**: 制御された環境で完全自動化のために**YOLOモード**を使用してください
4. **複雑なリファクタリング**: 詳細な計画のためにまず**プランモード**を使用し、その後実行用に適切なモードに切り替えてください